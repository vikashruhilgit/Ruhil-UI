{"version":3,"file":"EPayment.js","sourceRoot":"","sources":["../../../../src/component/epayment/EPayment.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, LitElement } from 'lit';\nimport { AxiosInstance } from 'axios';\nimport { property, state } from 'lit/decorators.js';\nimport {\n  addJsFunction,\n  addScript,\n  JSTypes,\n} from '../../utility/dynamic-script-loader';\n\nimport { styles } from './ePayment.css';\n\ninterface TsysConfig {\n  deviceID: number;\n  manifest: string;\n}\n// These are left commented out on purpose. If needed, please uncomment them\n// for testing the payment service.\n/* interface Payment {\n  cardDataSource?: string;\n  transactionAmount: number;\n  currencyCode?: string;\n  cardType: string;\n  cardNumber: string;\n  lastFour: string;\n  expirationDate: string;\n  cvv2: number;\n  cardHolderName: string;\n  addressLine1?: string;\n  zip: string;\n  cardOnFile?: string;\n  tokenRequired?: string;\n  email?: string;\n  manifest?: string;\n  transactionId: string;\n} */\n\nexport class EPayment extends LitElement {\n  // #region Component Properties & State\n  // These are left commented out on purpose. If needed, please uncomment them\n  // for testing the payment service.\n  // transactionAmount: number = 5.5;\n\n  @property({ type: String }) serviceUrl: string =\n    'http://localhost:5000/tsys-config';\n\n  @property({ type: String }) tsysHostUrl: string =\n    'https://stagegw.transnox.com/transit-tsep-web/jsView/';\n\n  @property({ type: String }) nameLabel: string = 'Name on Card';\n\n  @property({ type: String }) cardNumberLabel: string = 'Card Number';\n\n  @property({ type: String }) expiryLabel: string = 'MM/YYYY';\n\n  @property({ type: String }) zipLabel: string = 'Zip Code';\n\n  // @property({ type: String }) email: string = 'jilna.nt@busey.com';\n\n  // @property({ type: String }) adressLine: string = 'Chicago, USA';\n\n  // @property({ type: String }) cardDataSource: string = 'INTERNET';\n\n  @state() loading = true;\n\n  // #endregion\n  readonly paymentServiceUrl = 'http://localhost:5000/cardservice';\n\n  private tsysConfigData: TsysConfig | null = null;\n\n  // private uuid = new UUID();\n\n  connectedCallback() {\n    super.connectedCallback();\n    document.addEventListener('TSYSTokenEvent', (e: any) => {\n      // this._savePaymentDetails(e);\n      const payload = {\n        ...e.detail,\n        testManifest: this.tsysConfigData?.manifest,\n      };\n      const raiseEvent = new CustomEvent('TSYSCardValidationEvent', {\n        detail: payload,\n        bubbles: true,\n        composed: true,\n      });\n      document.dispatchEvent(raiseEvent);\n    });\n    document.addEventListener('TSYSFieldValidationError', e => {\n      this._formValidation(e, 'FAIL');\n    });\n    document.addEventListener('TSYSFieldValidationSuccess', e => {\n      this._formValidation(e, 'SUCCESS');\n    });\n    const iniatilisedComponet = new CustomEvent('EpaymentInitialised', {\n      detail: 'SUCCESS',\n      bubbles: true,\n      composed: true,\n    });\n    setTimeout(() => this.dispatchEvent(iniatilisedComponet));\n    // this._getTsysConfig();\n  }\n\n  disconnectedCallback() {\n    document.removeEventListener('TSYSTokenEvent', () => {\n      // this._savePaymentDetails(e);\n    });\n    document.removeEventListener('TSYSFieldValidationError', e => {\n      this._formValidation(e, 'FAIL');\n    });\n    document.removeEventListener('TSYSFieldValidationSuccess', e => {\n      this._formValidation(e, 'SUCCESS');\n    });\n    super.disconnectedCallback();\n  }\n\n  /**\n   * Disable Shadow root for this component as the TSYS script queries using the element id.\n   * @returns\n   */\n  createRenderRoot() {\n    return this;\n  }\n\n  // #region Private Functions\n  // These are left commented out on purpose. If needed, please uncomment them\n  // for testing the payment service.\n  /*     private _savePaymentDetails = (event: any) => {\n    if (event.detail) {\n      const uuidValue = this.uuid.getDashFreeUUID();\n      const data = event.detail;\n      const payload: Payment = {\n        transactionAmount: this.transactionAmount,\n        cardType: data.cardType,\n        cardNumber: data.tsepToken,\n        lastFour: data.maskedCardNumber,\n        expirationDate: data.expirationDate?.replace(/\\//g, ''),\n        cvv2: data.cvv2 != \" undefined\"? data.cvv2 : undefined,\n        cardHolderName: data.cardHolderName,\n        zip: data.zipCode,\n        manifest: data.tsepToken ? undefined : this.tsysConfigData?.manifest,\n        email: this.email,\n        addressLine1: this.adressLine,\n        cardDataSource: this.cardDataSource,\n        transactionId: uuidValue.substring(uuidValue.length - 7)\n      };\n      postRequest(this.paymentServiceUrl, payload)\n        .then(() => {})\n        .catch((e: any) => {\n          // eslint-disable-next-line no-console\n          console.warn('FAILED TO MAKE PAYMENT', e);\n        });\n    }\n  }; */\n\n  private _formValidation = (event: any, status: string) => {\n    if (status === 'SUCCESS') {\n      document.getElementById(`error_${event.detail.fieldName}`)?.remove();\n    } else {\n      const input = document.getElementById(event.detail.fieldName);\n      if (!document.getElementById(`error_${event.detail.fieldName}`)) {\n        const span = document.createElement('span');\n        span.innerText = event.detail.message;\n        span.id = `error_${event.detail.fieldName}`;\n        input?.parentNode?.insertBefore(span, input.nextSibling);\n      } else {\n        const span = document.getElementById(`error_${event.detail.fieldName}`);\n        span!.innerText = event.detail.message;\n      }\n    }\n  };\n\n  getTsysConfig(axiosObject: AxiosInstance, mId: string) {\n    if (axiosObject) {\n      axiosObject(this.serviceUrl, {\n        method: 'GET',\n        params: {\n          merchantId: mId,\n        },\n      })\n        .then((res: any) => {\n          this.tsysConfigData = res.data;\n          this._constructScriptTag();\n          addJsFunction(JSTypes.EPAYMENT);\n          this.loading = false;\n          // addStylesToHead(ePaymentstyles);\n        })\n        .catch((e: any) => {\n          // eslint-disable-next-line no-console\n          console.warn('Failed to get config with error', e);\n        });\n    }\n  }\n\n  private _constructScriptTag() {\n    if (!this.tsysConfigData?.deviceID || !this.tsysConfigData?.manifest) {\n      // eslint-disable-next-line no-console\n      console.warn('Cannot load script, data missing');\n      return;\n    }\n    const src = `${this.tsysHostUrl}${this.tsysConfigData?.deviceID}?${this.tsysConfigData?.manifest}`;\n    addScript({\n      src,\n      async: false,\n      referrerPolicy: 'strict-origin-when-cross-origin',\n    });\n  }\n  // #endregion\n\n  render() {\n    return html`\n      ${!this.loading\n        ? html` <form method=\"POST\" id=\"payment-form\">\n            <div id=\"tsep-cardHolderNameDiv\" data-validate-name=\"Y\">\n              <label id=\"tsep-label\">${this.nameLabel}</label>\n            </div>\n            <div\n              id=\"tsep-cardNumDiv\"\n              data-auto-formatting=\"Y\"\n              data-validate-cc=\"Y\"\n              data-detect-card-type=\"Y\"\n            >\n              <label id=\"tsep-label\">${this.cardNumberLabel}</label>\n            </div>\n            <div id=\"tsep-datepickerDiv\" data-validate-expiry-date=\"Y\">\n              <label id=\"tsep-label\">${this.expiryLabel}</label>\n            </div>\n            <div id=\"tsep-zipCodeDiv\" data-validate-zipcode=\"Y\">\n              <label id=\"tsep-label\">${this.zipLabel}</label>\n            </div>\n          </form>`\n        : null}\n    `;\n  }\n\n  static styles = styles;\n}\n"]}